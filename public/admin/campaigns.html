<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8">
  <title>Ø­Ù…Ù„Ø§Øª ÙˆØ¹Ø±ÙˆØ¶ - Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body style="text-align:right;">

  <header>
    <span>Ø­Ù…Ù„Ø§Øª ÙˆØ¹Ø±ÙˆØ¶</span>
    <a href="admin.html" style="color: #fff; float: left; text-decoration:none; font-size:14px;">
      Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
    </a>
  </header>

  <div class="container">
    <h2>Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ù„Ø© / Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯</h2>

    <form id="campaignForm">
      <div style="margin-bottom:10px;">
        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶:</label><br>
        <input type="text" id="title" required style="width:100%; padding:8px;">
      </div>

      <div style="margin-bottom:10px;">
        <label>ÙˆØµÙ / Ù†Øµ Ø§Ù„Ø¹Ø±Ø¶ (ÙŠØ¸Ù‡Ø± Ù„Ù„Ø²Ø¨Ø§Ø¦Ù†):</label><br>
        <textarea id="description" rows="3" style="width:100%; padding:8px;"></textarea>
      </div>

      <div style="margin-bottom:10px;">
        <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (%):</label><br>
        <input type="number" id="discountPercent" step="0.1" placeholder="Ù…Ø«Ø§Ù„: 10 ÙŠØ¹Ù†ÙŠ 10%" style="width:100%; padding:8px;">
      </div>

      <div style="margin-bottom:10px;">
        <label>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ (Ø´Ø§Ù‚Ù„):</label><br>
        <input type="number" id="minTotal" step="0.5" placeholder="Ù…Ø«Ø§Ù„: 200" style="width:100%; padding:8px;">
      </div>

      <div style="margin-bottom:10px;">
        <label>
          <input type="checkbox" id="active" checked>
          Ø§Ù„Ø¹Ø±Ø¶ Ù†Ø´Ø·ØŸ
        </label>
      </div>

      <button type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù…Ù„Ø©</button>
    </form>

    <hr style="margin:25px 0;">

    <h2>Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
    <p style="font-size:13px; color:#555;">
      ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ÙˆØµÙ ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… ÙˆØ­Ø¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØªÙØ¹ÙŠÙ„ / Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø£Ùˆ Ø­Ø°ÙÙ‡.
    </p>

    <div id="campaignsList">
      Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª...
    </div>
  </div>

  <script>
    const form = document.getElementById('campaignForm');
    const campaignsListEl = document.getElementById('campaignsList');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const discountPercent = document.getElementById('discountPercent').value || null;
      const minTotal = document.getElementById('minTotal').value || null;
      const active = document.getElementById('active').checked;

      try {
        const res = await fetch('/api/campaigns', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title,
            description,
            discountPercent,
            minTotal,
            active
          })
        });

        const data = await res.json();

        if (!res.ok || !data.success) {
          alert(data.error || 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù…Ù„Ø©');
          console.log(data);
          return;
        }

        alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ ğŸ¯');
        form.reset();
        document.getElementById('active').checked = true;
        loadCampaigns();
      } catch (err) {
        console.error(err);
        alert('Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±');
      }
    });

    async function loadCampaigns() {
      try {
        const res = await fetch('/api/campaigns');
        const data = await res.json();

        if (!data.length) {
          campaignsListEl.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù…Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>';
          return;
        }

        let html = `
          <table style="width:100%; border-collapse: collapse; font-size:14px;">
            <thead>
              <tr style="background:#f0f0f0;">
                <th style="border:1px solid #ddd; padding:6px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                <th style="border:1px solid #ddd; padding:6px;">Ø§Ù„ÙˆØµÙ</th>
                <th style="border:1px solid #ddd; padding:6px;">Ø§Ù„Ø®ØµÙ… (%)</th>
                <th style="border:1px solid #ddd; padding:6px;">Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨ (Ø´Ø§Ù‚Ù„)</th>
                <th style="border:1px solid #ddd; padding:6px;">Ù†Ø´Ø·ØŸ</th>
                <th style="border:1px solid #ddd; padding:6px;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
        `;

        data.forEach(c => {
          html += `
            <tr>
              <td style="border:1px solid #ddd; padding:4px;">
                <input type="text" id="title-${c.id}" value="${c.title}" style="width:100%; padding:4px;">
              </td>
              <td style="border:1px solid #ddd; padding:4px;">
                <input type="text" id="description-${c.id}" value="${c.description || ''}" style="width:100%; padding:4px;">
              </td>
              <td style="border:1px solid #ddd; padding:4px;">
                <input type="number" step="0.1" id="discountPercent-${c.id}" value="${c.discountPercent ?? ''}" style="width:100%; padding:4px;">
              </td>
              <td style="border:1px solid #ddd; padding:4px;">
                <input type="number" step="0.5" id="minTotal-${c.id}" value="${c.minTotal ?? ''}" style="width:100%; padding:4px;">
              </td>
              <td style="border:1px solid #ddd; padding:4px; text-align:center;">
                <input type="checkbox" id="active-${c.id}" ${c.active ? 'checked' : ''}>
              </td>
              <td style="border:1px solid #ddd; padding:4px; text-align:center;">
                <button onclick="updateCampaign(${c.id})" style="margin-bottom:4px;">ØªØ­Ø¯ÙŠØ«</button>
                <br>
                <button onclick="deleteCampaign(${c.id})" style="background:#c0392b; color:white;">Ø­Ø°Ù</button>
              </td>
            </tr>
          `;
        });

        html += `
            </tbody>
          </table>
        `;

        campaignsListEl.innerHTML = html;
      } catch (err) {
        console.error(err);
        campaignsListEl.innerHTML = '<p style="color:red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù…Ù„Ø§Øª</p>';
      }
    }

    async function updateCampaign(id) {
      const title = document.getElementById('title-' + id).value;
      const description = document.getElementById('description-' + id).value;
      const discountPercent = document.getElementById('discountPercent-' + id).value || null;
      const minTotal = document.getElementById('minTotal-' + id).value || null;
      const active = document.getElementById('active-' + id).checked;

      try {
        const res = await fetch('/api/campaigns/' + id, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title,
            description,
            discountPercent,
            minTotal,
            active
          })
        });

        const data = await res.json();

        if (!res.ok || !data.success) {
          alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù…Ù„Ø©');
          console.log(data);
          return;
        }

        alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…');
        loadCampaigns();
      } catch (err) {
        console.error(err);
        alert('Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±');
      }
    }

    async function deleteCampaign(id) {
      if (!confirm('Ù…ØªØ£ÙƒØ¯ Ø¨Ø¯Ùƒ ØªØ­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù…Ù„Ø©ØŸ')) return;

      try {
        const res = await fetch('/api/campaigns/' + id, {
          method: 'DELETE'
        });

        const data = await res.json();

        if (!res.ok || !data.success) {
          alert('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ù…Ù„Ø©');
          console.log(data);
          return;
        }

        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ù…Ù„Ø© âŒ');
        loadCampaigns();
      } catch (err) {
        console.error(err);
        alert('Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø³ÙŠØ±ÙØ±');
      }
    }

    document.addEventListener('DOMContentLoaded', loadCampaigns);
  </script>

</body>
</html>
